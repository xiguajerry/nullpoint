package me.nullpoint.mod.modules.impl.exploit;

import com.mojang.authlib.GameProfile;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.UUID;
import me.nullpoint.api.events.eventbus.EventHandler;
import me.nullpoint.api.events.impl.PacketEvent;
import me.nullpoint.mod.modules.Module;
import me.nullpoint.mod.modules.settings.impl.BooleanSetting;
import net.minecraft.client.network.OtherClientPlayerEntity;
import net.minecraft.entity.Entity.RemovalReason;
import net.minecraft.network.packet.Packet;
import net.minecraft.network.packet.c2s.common.KeepAliveC2SPacket;
import net.minecraft.network.packet.c2s.play.AdvancementTabC2SPacket;
import net.minecraft.network.packet.c2s.play.ChatMessageC2SPacket;
import net.minecraft.network.packet.c2s.play.ClickSlotC2SPacket;
import net.minecraft.network.packet.c2s.play.ClientStatusC2SPacket;
import net.minecraft.network.packet.c2s.play.CommandExecutionC2SPacket;
import net.minecraft.network.packet.c2s.play.PlayerMoveC2SPacket;
import net.minecraft.network.packet.c2s.play.RequestCommandCompletionsC2SPacket;
import net.minecraft.network.packet.c2s.play.TeleportConfirmC2SPacket;

public class Blink extends Module {
   public static Blink INSTANCE = new Blink();
   private final ArrayList packetsList = new ArrayList();
   public static OtherClientPlayerEntity fakePlayer;
   private final BooleanSetting allPacket = this.add(new BooleanSetting("AllPacket", true));

   public Blink() {
      super("Blink", "Fake lag", Module.Category.Exploit);
      INSTANCE = this;
   }

   public void onEnable() {
      this.packetsList.clear();
      if (nullCheck()) {
         this.disable();
      } else {
         fakePlayer = new OtherClientPlayerEntity(mc.world, new GameProfile(UUID.fromString("11451466-6666-6666-6666-666666666601"), mc.player.getName().getString()));
         fakePlayer.copyPositionAndRotation(mc.player);
         fakePlayer.bodyYaw = mc.player.bodyYaw;
         fakePlayer.headYaw = mc.player.headYaw;
         fakePlayer.getInventory().clone(mc.player.getInventory());
         mc.world.addEntity(fakePlayer);
      }
   }

   public void onUpdate() {
      if (mc.player.isDead()) {
         this.packetsList.clear();
         this.disable();
      }

   }

   public void onLogin() {
      if (this.isOn()) {
         this.packetsList.clear();
         this.disable();
      }

   }

   @EventHandler
   public void onSendPacket(PacketEvent.Send event) {
      Packet t = event.getPacket();
      if (!(t instanceof ChatMessageC2SPacket)) {
         if (!(t instanceof RequestCommandCompletionsC2SPacket)) {
            if (!(t instanceof CommandExecutionC2SPacket)) {
               if (!(t instanceof TeleportConfirmC2SPacket)) {
                  if (!(t instanceof KeepAliveC2SPacket)) {
                     if (!(t instanceof AdvancementTabC2SPacket)) {
                        if (!(t instanceof ClientStatusC2SPacket)) {
                           if (!(t instanceof ClickSlotC2SPacket)) {
                              if (t instanceof PlayerMoveC2SPacket || this.allPacket.getValue()) {
                                 this.packetsList.add(event.getPacket());
                                 event.cancel();
                              }

                           }
                        }
                     }
                  }
               }
            }
         }
      }
   }

   public void onDisable() {
      if (nullCheck()) {
         this.packetsList.clear();
         this.disable();
      } else {
         if (fakePlayer != null) {
            fakePlayer.kill();
            fakePlayer.setRemoved(RemovalReason.KILLED);
            fakePlayer.onRemoved();
            fakePlayer = null;
         }

         Iterator var1 = this.packetsList.iterator();

         while(var1.hasNext()) {
            Packet packet = (Packet)var1.next();
            mc.player.networkHandler.sendPacket(packet);
         }

      }
   }

   public String getInfo() {
      return String.valueOf(this.packetsList.size());
   }
}
